
{% extends 'qr_detector/base.html' %}

{% block content %}

<div class="card">
    <h2>Scan Result</h2>

    <!-- Risk Badge -->
    <span class="risk-badge risk-{{ scan.risk_level|lower }}">{{ scan.risk_level }}</span>
    
    {% if scan.uploaded_image %}
    <div class="qr-preview" style="margin-top:1rem; max-width:260px;">
        <img src="{{ scan.uploaded_image.url }}" alt="QR Image" style="width:100%; border-radius:0.8rem;">
    </div>
    {% endif %}

    <div class="result-layout">
        <div class="result-details">
            <table class="detail-table" style="margin-top:1rem;">
                <tr><th>UPI ID</th><td>{{ scan.upi_id|default:"Not detected" }}</td></tr>
                <tr><th>Name</th><td>{{ scan.name|default:"Unknown" }}</td></tr>
                <tr><th>Receiver</th><td>{{ scan.receiver|default:"Unknown" }}</td></tr>
                <tr><th>Risk Category</th><td>{{ scan.risk_level }}</td></tr>
                <tr><th>Detection Score</th><td>{{ scan.ml_score }} / 100</td></tr>
                <tr><th>Reason</th><td>{{ scan.reason }}</td></tr>
                <tr><th>Scanned At</th><td>{{ scan.created_at }}</td></tr>
            </table>

            <details class="decoded" style="margin-top:1rem;">
                <summary style="cursor:pointer;">View full decoded QR text</summary>
                <pre style="margin-top:10px;">{{ scan.decoded_text }}</pre>
            </details>

            <div class="actions" style="margin-top:1.2rem;">
                <a class="btn-secondary" href="{% url 'index' %}">Scan Another QR</a>
                <a class="btn-outline" href="{% url 'history' %}">View Scan History</a>
                <a class="btn-outline" href="{% url 'dashboard' %}">Back to Dashboard</a>
            </div>
        </div>
    </div>
</div>

<!-- ðŸ”¥ Auto Warning Popup JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const risk = "{{ scan.risk_level }}";

    if (risk === "SCAM") {
        alert("ðŸš¨ WARNING!\nThis QR appears to be SCAM.\nDo NOT make any payment to the receiver.");
    }
    else if (risk === "SUSPICIOUS") {
        alert("âš  CAUTION!\nThis QR looks suspicious.\nVerify before sending money.");
    }
});
</script>

{% endblock %}
